"use strict";(self.webpackChunkframework=self.webpackChunkframework||[]).push([[184],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=d(a),m=i,h=c["".concat(l,".").concat(m)]||c[m]||p[m]||r;return a?n.createElement(h,o(o({ref:t},u),{},{components:a})):n.createElement(h,o({ref:t},u))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5152:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=a(7462),i=(a(7294),a(3905));const r={id:"data_quality",title:"Data Quality",sidebar_position:4},o=void 0,s={unversionedId:"engineering/data_quality",id:"engineering/data_quality",title:"Data Quality",description:"BI Transformation Process Testing Coverage",source:"@site/docs/engineering/data_quality.md",sourceDirName:"engineering",slug:"/engineering/data_quality",permalink:"/framework/engineering/data_quality",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"data_quality",title:"Data Quality",sidebar_position:4},sidebar:"frameworkSidebar",previous:{title:"Improve Context",permalink:"/framework/engineering/transformations/ai_augmentations/improve_context"},next:{title:"Orchestration",permalink:"/framework/engineering/orchestration"}},l={},d=[{value:"BI Transformation Process Testing Coverage",id:"bi-transformation-process-testing-coverage",level:2},{value:"Test Coverage",id:"test-coverage",level:3},{value:"Protective Layer",id:"protective-layer",level:3},{value:"Down with Pipeline debt / Introducing Great Expectations",id:"down-with-pipeline-debt--introducing-great-expectations",level:2},{value:"Observability for Data Engineering",id:"observability-for-data-engineering",level:2},{value:"Data testing: why you need it and how to get started",id:"data-testing-why-you-need-it-and-how-to-get-started",level:2},{value:"How great data teams test their data models",id:"how-great-data-teams-test-their-data-models",level:2}],u={toc:d},c="wrapper";function p(e){let{components:t,...a}=e;return(0,i.kt)(c,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"bi-transformation-process-testing-coverage"},"BI Transformation Process Testing Coverage"),(0,i.kt)("h3",{id:"test-coverage"},"Test Coverage"),(0,i.kt)("p",null,"To provide context, let\u2019s review the BI transformation process and the main layers that are composing it. Below is a graphical representation of how data is being progressively transformed into the public warehouse/BI layer."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://codahosted.io/docs/S4IjqJCq2i/blobs/bl-0nlKGel35w/3b964437774727eced6e1b0c3d67317c7f66935edbbeed755f0b1cc867329f3b45ecea7e625b8a519a9d53379f2e4abf76456c10cd36b9701745a6526486fc9507f9ab4b239c2a9edd67f4f8677d66a4fb3e5ac75fe640b4455c0f352a0a669e7fbb5035",alt:"Screen Shot 2020-08-10 at 10.19.49 AM.png"})),(0,i.kt)("p",null,"There are essentially 4 types of models in that graph:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Sources: Those green models are pointers to the raw data we are consuming."),(0,i.kt)("li",{parentName:"ol"},"Staging models: This is the first layer of transformation, where we do basic cleaning (renaming, casting to data type, deduplication, filtering, etc.) operations on the source data. This is where our core assumptions about the shape of the data are."),(0,i.kt)("li",{parentName:"ol"},"Integration models: This layer integrates multiple sources of data to come up with single entities. For example, we might have user information coming in from the product and a CRM. We would integrate those sources together to come up with a single complete view of that entity (users)."),(0,i.kt)("li",{parentName:"ol"},"Warehousing models: This layer creates the public entities (such as users, events, sessions, etc.) that are to be consumed in a BI tool or by analysts.")),(0,i.kt)("p",null,"The tests we are putting in place automates a decision process that is enabled at each stage of the BI transformation. Throughout that flow of data, we run different sets of tests that will take 1 of 3 decisions:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Everything is conforming to expectations, we can proceed to the next stage of transformation"),(0,i.kt)("li",{parentName:"ul"},"There are non-major issues in the data that should be looked into, but we can proceed to the next stage of transformation"),(0,i.kt)("li",{parentName:"ul"},"There are major issues with the data, we are not to proceed to the next stage of transformation.")),(0,i.kt)("p",null,"This looks a bit like the following\u2026"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://codahosted.io/docs/S4IjqJCq2i/blobs/bl-WTf96jBcoT/06f3678d73425ee3aeecffaf6dd853f7593833a69d1b544ea23b2d4a8aed5d98963e48f50d0e58503701840ae0b0a9d168775fe90768904f090dd2c753136814f027c6d029a643b3e3479af8f288d2551fc9033a2e4ef447ebd47ec05159244e7d3f33f9",alt:"efabf651-3bd2-4f1e-a72d-0d51a85e3ea7.png"})),(0,i.kt)("h3",{id:"protective-layer"},"Protective Layer"),(0,i.kt)("p",null,"The idea of a protection layer is to have a line of defence against non-conforming data and be warned as soon as possible about those issues. For this purpose, we are introducing a suite of tests that inspects data and validates they conform to our assumptions."),(0,i.kt)("p",null,"An example of that is that we could have check that a timestamp field:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Actually exists and is named created_ts"),(0,i.kt)("li",{parentName:"ul"},"Is a datetime type"),(0,i.kt)("li",{parentName:"ul"},"Is never null"),(0,i.kt)("li",{parentName:"ul"},"Its value is never beyond the current date"),(0,i.kt)("li",{parentName:"ul"},"Etc.")),(0,i.kt)("p",null,"In dbt, we can test for all of those assumptions in what is called schema tests."),(0,i.kt)("p",null,"There are multiple types of schema tests. See dbt\u2019s and dbt_util\u2019s documentations:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.getdbt.com/docs/building-a-dbt-project/tests/"},"dbt schema tests")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/fishtown-analytics/dbt-utils"},"dbt_utils schema tests"))),(0,i.kt)("p",null,"It should be noted that it\u2019s fairly easy to create your own schema tests. For example, we use a accepted_value_range custom schema test, which checks that a numeric value is within a certain range."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"down-with-pipeline-debt--introducing-great-expectations"},"Down with Pipeline debt / Introducing Great Expectations"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://medium.com/@expectgreatdata/down-with-pipeline-debt-introducing-great-expectations-862ddc46782a"},"https://medium.com/@expectgreatdata/down-with-pipeline-debt-introducing-great-expectations-862ddc46782a")),(0,i.kt)("li",{parentName:"ul"},'"Like other forms of technical debt, pipeline debt accumulates when unclear or forgotten assumptions are buried inside a complex, interconnected codebase."'),(0,i.kt)("li",{parentName:"ul"},'"It\u2019s easy for debt to accumulate in data pipelines, since\u2026'),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Data systems naturally evolve to become more interconnected ","[...]"," In a DAG context, \u201csilo-free\u201d is isomorphic to \u201ctangled and messy.\u201d Your pipelines wants to be a hairball, and your PMs, execs, and customers agree.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Data pipelines cross team borders ","[...]",' Most organizations are set up so that new models, dashboards, etc. require at least one analyst-to-engineer handoff before they make it to production. The difference in skill set and tools creates tons of surface area for pipeline debt to creep in."'))))),(0,i.kt)("li",{parentName:"ul"},'"Pipeline debt introduces both productivity costs and operational risk."'),(0,i.kt)("li",{parentName:"ul"},'"This kind of bugginess erodes trust, sometimes to the point of putting the core usefulness of the data system in doubt. What good is a dashboard/report/prediction/etc if you don\u2019t trust what it says?"'),(0,i.kt)("li",{parentName:"ul"},'"Instead of just testing code, we should be testing data. After all, that\u2019s where the complexity lives."'),(0,i.kt)("li",{parentName:"ul"},'"Intuitively, we know that pipeline testing is a good idea. However, the practice of pipeline testing is missing two very important things. First, shared vocabulary for describing and reasoning about pipeline debt and pipeline tests. Second, effective, open tools for implementing pipeline testing in practice."')),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"observability-for-data-engineering"},"Observability for Data Engineering"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://medium.com/databand-ai/observability-for-data-engineering-a2e826587205"},"https://medium.com/databand-ai/observability-for-data-engineering-a2e826587205")),(0,i.kt)("li",{parentName:"ul"},'"For companies with serious data infrastructure, the lack of specialized management tools leads to major inefficiencies and productivity gaps."'),(0,i.kt)("li",{parentName:"ul"},'"The reason standard tools don\u2019t cut it is because data pipelines behave very differently than software applications and infrastructure."'),(0,i.kt)("li",{parentName:"ul"},'"Here are some best practices we recommend to begin:'),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Make incremental investments in data/metadata collection from your DAGs.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Define pipeline regression tests and track your test metrics."),(0,i.kt)("li",{parentName:"ul"},'Define & monitor standard KPIs that you can align all roles on \u2014 data engineers, analysts, and scientists."')))))),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"data-testing-why-you-need-it-and-how-to-get-started"},"Data testing: why you need it and how to get started"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://blog.getdbt.com/data-testing-why-you-need-it-and-how-to-get-started/"},"https://blog.getdbt.com/data-testing-why-you-need-it-and-how-to-get-started/")),(0,i.kt)("li",{parentName:"ul"},'"The data team had no way to keep tabs on all the changes happening in the business, so they spent an enormous amount of time reacting to problems as end users reported them. And every problem eroded trust."'),(0,i.kt)("li",{parentName:"ul"},'"What if instead of reacting, you could put proactive systems in place that would give you visibility into data problems before those changes impacted the end user? This is mindset that software engineers use to build systems for high reliability."'),(0,i.kt)("li",{parentName:"ul"},'"Data testing is the practice of making assertions about your data, and then testing whether these assertions are valid. This concept can be used to test both the quality of your source data and to validate that the code in your data models is working as intended."'),(0,i.kt)("li",{parentName:"ul"},'"Tim Finkel calls this \u201cbuilding the immune system.\u201d"'),(0,i.kt)("li",{parentName:"ul"},"Test during different phases"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Development",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'"Sources: Use simple schema tests like uniqueness and not_null to check for data quality and test your basic assumptions about the source data"',(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'"Staging models: Transformation tests to make sure you didn\'t create duplicates or fan out a join"'),(0,i.kt)("li",{parentName:"ul"},'"dim/fact models: Test core business logic using relationship test, expression tests, recency tests, etc."'),(0,i.kt)("li",{parentName:"ul"},'"Across models: ex: making sure all orders contain at least one order from a certain product category"'))))),(0,i.kt)("li",{parentName:"ul"},"Pull Requests"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'"Whenever a Pull Request is made against our internal-analytics repo, dbt Cloud will kick off a job that builds and tests all models in your development branch in a scratch schema"'))),(0,i.kt)("li",{parentName:"ul"},"In Production"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'"Automated tests ensure that when something changes about your business or the data, you \u2013 not your end user \u2013 are the first to know."')))))))),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"how-great-data-teams-test-their-data-models"},"How great data teams test their data models"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://blog.getdbt.com/how-great-data-teams-test-their-data-models/"},"https://blog.getdbt.com/how-great-data-teams-test-their-data-models/")),(0,i.kt)("li",{parentName:"ul"},"If you're wondering how to tackle data testing, there are worst ways to proceed than to read advices from very smart people in that field.")))}p.isMDXComponent=!0}}]);